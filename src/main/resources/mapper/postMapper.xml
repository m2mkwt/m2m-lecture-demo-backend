<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.m2m.instagram.post.mapper.PostMapper">
	<insert id="insertPost">
		INSERT INTO instagram.dbo.post (member_no,media_no, content) 
		VALUES (#{memberNo},#{mediaNo},#{content})
	</insert>
	<delete id="deletePost">
		UPDATE instagram.dbo.post 
		SET delete_yn = 'Y' 
		WHERE post_no = #{postNo}
	</delete>
	<update id="updatePost">
		UPDATE instagram.dbo.post 
		SET content = #{content} 
		WHERE post_no = #{postNo}
	</update>
	<select id="selectPost" resultType="kr.co.m2m.instagram.post.model.PostVO">
		SELECT TPO.post_no
		      ,TPO.member_no
			  ,TPO.content
			  ,format(TPO.createdt,'yyyy년 MM월 dd일 HH시 mm분')
			  ,TPO.like_cnt
			  ,TMB.login_id  AS login_id
			  , (SELECT count(*) FROM dbo.comment AS TCO WHERE TCO.post_no = TPO.post_no and TCO.delete_yn = 'N' ) AS comment_cnt
			  , (SELECT TME.filename FROM dbo.media AS TME WHERE TME.media_no = TPO.media_no ) AS filename
		  FROM dbo.post AS TPO
		 INNER JOIN dbo.member AS TMB
		    ON TPO.member_no = TMB.member_no
		 WHERE TPO.delete_yn = 'N'
	  ORDER BY TPO.createdt DESC;
	
	</select>
	<select id="selectPostDetail" resultType="kr.co.m2m.instagram.post.model.PostVO">
		SELECT TPO.post_no
			  ,TPO.content
			  ,format(TPO.createdt,'yyyy년 MM월 dd일 HH시 mm분')
			  ,TPO.like_cnt
			  , (SELECT TMB.login_id FROM dbo.member AS TMB WHERE TMB.member_no = TPO.member_no ) AS login_id
			  , (SELECT TME.filename FROM dbo.media AS TME WHERE TME.media_no = TPO.media_no ) AS filename
		  FROM dbo.post AS TPO
		  where post_no = #{postNo} AND TPO.delete_yn = 'N';
	</select>
	<select id="selectPostAll" resultType="PostVO">
		SELECT * 
		FROM dbo.post
	</select>
	
	<!-- 내 게시글 개수 조회 -->
	<select id="countPost" parameterType="Integer" resultType="Integer">
		SELECT COUNT(*)
		FROM dbo.post
		WHERE member_no = #{memberNo}
	</select>
	
	<!-- 내 게시글 리스트 조회 -->
	<select id="selectMyPost" parameterType="Integer" resultType="java.util.Map">
		SELECT P.post_no, M.filename
		FROM dbo.post P, dbo.media M
		WHERE P.media_no = M.media_no
			and P.member_no = #{memberNo}
			AND P.delete_yn = 'N'
	   ORDER BY P.createdt DESC;
	</select>
	
</mapper>